# 리눅스 커널 printk 디버깅 가이드

## 1. printk의 기본 역할

### 주요 기능
**커널 로그에 디버그 메시지를 출력**

#### 특징
- **표준 함수**: 리눅스 커널의 표준 디버깅 함수
- **커널 로그**: 커널 내부 동작을 외부로 출력
- **필수 도구**: 커널 내부 동작 확인에 필수적

#### 사용 목적
- 커널 코드 실행 흐름 추적
- 변수 값 확인
- 오류 발생 지점 파악
- 시스템 상태 모니터링

<br>

## 2. 로그 레벨 시스템

### 로그 레벨의 영향
**설정된 레벨 이하의 심각도(숫자 기준)를 가진 메시지만 출력**

#### 동작 원리
- **심각도 기반**: 메시지의 중요도에 따른 필터링
- **레벨 제어**: 출력될 메시지 범위 조절
- **선택적 출력**: 필요한 정보만 선별적으로 확인

#### 로그 레벨 종류
- **KERN_EMERG (0)**: 시스템 사용 불가
- **KERN_ALERT (1)**: 즉시 조치 필요
- **KERN_CRIT (2)**: 중대한 상황
- **KERN_ERR (3)**: 오류 상황
- **KERN_WARNING (4)**: 경고
- **KERN_NOTICE (5)**: 정상이지만 중요한 상황
- **KERN_INFO (6)**: 정보성 메시지
- **KERN_DEBUG (7)**: 디버그 메시지

<br>

## 3. 시스템 Bring Up 시 설정 전략

### 권장 설정
**예상치 못한 문제를 식별하기 위해 최대 레벨로 설정**

#### 이유
- **예측 불가능한 문제**: Bring Up 단계의 다양한 잠재적 이슈
- **완전한 정보 수집**: 모든 가능한 디버그 정보 확보
- **문제 조기 발견**: 숨겨진 문제점 식별

#### 설정 방법
```bash
# 부트 파라미터에서 설정
loglevel=8

# 런타임에서 설정
echo 8 > /proc/sys/kernel/printk
```

<br>

## 4. printk 사용 시 주의사항

### 성능 영향
**시스템 오버헤드 증가로 인한 성능 저하 또는 시스템 불안정 유발 가능**

#### 주의해야 할 상황
- **빈번한 호출**: 인터럽트 핸들러 등에서 과도한 사용
- **성능 중요 코드**: 타이밍이 중요한 코드 영역
- **대량 출력**: 많은 양의 로그 생성

#### 발생 가능한 문제
- **시스템 부하 증가**: CPU 및 메모리 사용량 상승
- **타이밍 이슈**: 실시간 처리에 영향
- **시스템 불안정**: 과도한 로그로 인한 시스템 장애

#### 해결 방안
- **조건부 출력**: 필요시에만 로그 출력
- **로그 레벨 조정**: 개발/운영 환경별 적절한 레벨 설정
- **대안 도구 활용**: ftrace 등 다른 디버깅 도구 사용

<br>

## 5. 커널 로그 확인 방법

### dmesg 유틸리티
**커널 로그를 터미널에서 확인하는 가장 일반적인 도구**

#### 기본 사용법
```bash
# 전체 커널 로그 출력
dmesg

# 실시간 로그 모니터링
dmesg -w

# 타임스탬프와 함께 출력
dmesg -T

# 특정 레벨만 필터링
dmesg -l err,warn
```

#### 특징
- **커널 로그 버퍼**: 시스템 부팅 메시지 포함
- **실시간 확인**: 새로운 로그 실시간 모니터링 가능
- **필터링 기능**: 레벨별, 시간별 필터링 지원

### 기타 로그 확인 방법
```bash
# 로그 파일에서 확인
tail -f /var/log/kern.log
tail -f /var/log/messages

# journalctl 사용 (systemd 환경)
journalctl -k -f
```

<br>

## 실무 활용 팁

### 1. 효과적인 로그 메시지 작성
```c
// 좋은 예시
printk(KERN_INFO "driver_name: Function %s called with param=%d\n", 
       __func__, param);

// 피해야 할 예시
printk("debug\n");  // 정보가 부족함
```

### 2. 조건부 디버깅
```c
#ifdef DEBUG
#define dbg_printk(fmt, args...) printk(KERN_DEBUG fmt, ##args)
#else
#define dbg_printk(fmt, args...) do {} while(0)
#endif
```

### 3. 로그 레벨별 사용 기준
- **KERN_ERR**: 실제 오류 발생 시
- **KERN_WARNING**: 잠재적 문제 상황
- **KERN_INFO**: 중요한 상태 변화
- **KERN_DEBUG**: 개발 중 디버깅 정보

<br>

## 핵심 요점

1. **printk**: 커널 디버깅의 기본 도구
2. **로그 레벨**: 메시지 출력 범위 제어
3. **Bring Up**: 최대 레벨로 설정하여 모든 정보 확보
4. **성능 주의**: 빈번한 사용 시 시스템 영향 고려
5. **dmesg**: 커널 로그 확인의 표준 도구

printk는 간단하지만 강력한 디버깅 도구로, 적절한 사용법을 익히면 효과적인 커널 디버깅이 가능합니다.